##概念

什么是闭包 ? 先看看维基百科的定义:

> 在计算机科学中，闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures），是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。 

自己简单概括一下：闭包就是引用了自由变量的函数，这个函数保存了与其相关的引用环境。

那自由变量是什么？保存的引用环境是什么？

自由变量可以简单的理解成在闭包外部定义赋值，在闭包内部引用的变量。

举个简单的例子：

```javascript
function f1(){
　　　　var n=666;
　　　return　function f2(){
　　　　　　alert(n); 
　　　　}
　　}
var f3 = f1();
console.log(n);//undefined
console.log(f3());//666
```

看看上面这段代码，然后再回过头看定义，就可以很好的理解了，```f2```就是闭包，因为它引用了自由变量```n```，他的作用是保存了```n```的值，```n```对于这个闭包来说就是它的引用环境了。

要想明白闭包究竟是怎么实现，首先要明白JavaScript中的内存分配和内存回收机制，弄懂JavaScript代码是如何运行的，下面我简单的说明一下。

###内存分配

我们知道，javascript中的变量分为两种，原始值和引用值。原始值指的是原始数据类型的值，比如undefined,null,number,string,boolean等类型所表示的值。引用值指的是复合数据类型的值，即Object,Function,Array等。

原始值和引用值存储在内存中的位置分别为栈和堆。原始值是存储在栈中的简单数据段，他们的值直接存储在变量访问的位置。引用值是存储在堆中的对象。 







